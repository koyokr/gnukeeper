# Gnuboard5 보안 플러그인 개발 프로젝트

## 프로젝트 개요

gnuboard5를 위한 종합적인 보안 플러그인을 개발합니다. WordPress의 보안 플러그인과 같이 일반 사용자가 쉽게 사이트를 보호할 수 있도록 다양한 보안 기능을 제공합니다.

개발 방식:
- 관리자 인터페이스: `/adm/` 디렉토리에 직접 추가 (메뉴, 페이지, 스타일)
- 보안 로직: `extend/` 또는 `plugin/` 디렉토리에 PHP 파일을 추가하는 방식으로 개발

개발 규칙:
- 기존 gnuboard5 파일 수정 금지: `.gitignore`에서 예외 처리되지 않은 기존 파일은 절대 수정하지 않음
- 새 파일 추가 시: 반드시 `.gitignore`에 예외 항목(`!파일경로`) 추가
- 허용된 수정 파일: 현재 `.gitignore`에서 예외 처리된 파일들만 수정 가능
  - `!adm/admin.menu950.php`
  - `!adm/security_home.php` 
  - `!adm/css/admin.css`
  - `!adm/img/menu_shield.png`

## 주요 기능 분류

### 1. 접근 제어 (Access Control)

#### 1.1 페이지 접근 권한 설정
목적: 특정 페이지에 대한 접근 권한을 세분화하여 제어

권한 레벨:
- 관리자: 최고 관리자만 접근 가능
- 회원: 로그인한 회원만 접근 가능  
- 방문자: 모든 사용자 접근 가능
- On/Off: 페이지 자체의 활성화/비활성화

대상 페이지:

검색 & 컨텐츠:
- /bbs/search.php [통합 검색] - [관리자 / 회원 / 방문자]
- /bbs/new.php [최신글 보기] - [관리자 / 회원 / 방문자]
- /bbs/faq.php [FAQ 페이지] - [관리자 / 회원 / 방문자]
- /bbs/content [웹페이지내 정적 content(Ex. 약관) 보기] - [관리자 / 회원 / 방문자]
- /bbs/current_connect.php [현재 접속자] - [관리자 / 회원 / 방문자]
- /bbs/group.php [그룹] - [관리자 / 회원 / 방문자]

회원 관련:
- /bbs/register.php [회원가입] - [On/Off]으로 한정
- /bbs/password_lost.php [비밀번호 찾기] - [On/Off]으로 한정
- /bbs/memo.php [쪽지] - [관리자/회원]으로 권한 한정
- /bbs/profile.php [회원 프로필] - [관리자/회원]으로 권한 한정

게시판/설문 관련:
- /bbs/board.php(+/bbs/download.php) [게시판] - [관리자 / 회원 / 방문자]
- /bbs/scrap.php [스크랩] - [관리자/회원]으로 권한 한정
- /bbs/poll_result.php [투표] - [관리자 / 회원 / 방문자]
- /bbs/qalist.php(+/bbs/qadownload.php) [QA] - [관리자/회원]으로 권한 한정
- /bbs/link.php [링크] - [관리자 / 회원 / 방문자]

구현 방식: 
- 각 페이지에 접근 시 권한 체크 로직 삽입
- 특정 기능과 연관된 php 파일도 모두 적용

#### 1.2 관리자 페이지 IP 제한
목적: 관리자 페이지 접근을 특정 IP에서만 허용

기능:
- 허용 IP 목록 관리
- CIDR 표기법 지원
- 여러 IP 대역 설정 가능

### 2. 차단 관리 (Block Management)

#### 2.1 IP 블랙리스트 관리
기존 기능 확장: gnuboard5의 기본 IP 차단 기능을 개선

추가 기능:
- CIDR 표기법 지원 (예: 192.168.1.0/24)
- 차단 사유 기록
- 차단 기간 설정 (영구, 임시)
- 자동 해제 기능

관리 기능:
- 차단 목록 조회/편집
- 차단 통계
- 차단 로그 기록

### 3. 권한 관리 (Permission Management)

#### 3.1 게시판 권한 보안 강화
문제점: 권한이 1이면 비회원도 읽을 수 있기 때문에 식별하고 수정할 수 있어야 함

대상 권한:
- 목록보기 (list)
- 글읽기 (read)
- 글쓰기 (write)
- 글답변 (reply)
- 댓글쓰기 (comment)
- 링크 (link)
- 업로드 (upload)
- 다운로드 (download)
- HTML쓰기 (html)

#### 3.2 일괄 권한 설정
목적: 전체 사이트 권한을 한 번에 설정

기능:
- 모든 게시판에 대해 위 권한들을 일괄 적용
- 권한 템플릿 저장/불러오기
- 권한 변경 이력 관리

### 4. 스팸 관리 (Spam Management)

#### 4.1 다회 시도 차단
로그인 브루트포스 방지:
- 연속 로그인 실패 횟수 제한
- 잘 알려진 비밀번호 패턴 차단
- 계정별/IP별 차단 설정

게시글/댓글 등록 제한:
- 연속 등록 시간 간격 제한
- 같은 내용 반복 등록 방지

404 페이지 접속 모니터링:
- 허니팟 페이지 생성
- 의심스러운 접근 패턴 탐지

#### 4.2 스팸 방지
내용 기반 자동 스팸 처리:
- 키워드 필터링
- 정규식 기반 패턴 매칭
- 스팸 점수 시스템

고스트 모드:
- 스팸으로 처리된 글을 작성자에게만 보이게 함
- IP 또는 회원 여부로 구분

#### 4.3 사후 관리
스팸 관리 인터페이스:
- 스팸/의심 글 목록
- 유형별 필터링
- 일괄 삭제 기능
- 오탐 복구 기능

### 5. 시스템 보안 (System Security)

#### 5.1 SSL 관리
원클릭 SSL 설정:
- Let's Encrypt 자동 설정
- SSL 인증서 상태 확인
- HTTPS 리다이렉션 설정

SSL 진단:
- 인증서 만료일 확인
- SSL 설정 검증
- 보안 등급 평가

#### 5.2 웹서버 설정 관리
.htaccess 설정/진단:
- 보안 헤더 설정
- 디렉토리 접근 제한
- 파일 업로드 제한

Apache/PHP 설정 진단:
- 보안 관련 설정 확인
- 권장 설정 안내
- 취약점 설정 검출

#### 5.3 파일 권한 관리
주요 PHP 파일 권한 설정/진단:
- 실행 파일 권한 확인
- 쓰기 권한 점검
- 디렉토리 권한 검증

### 6. 플랫폼 관리 (Platform Management)

#### 6.1 버전 관리
gnuboard5 버전/플러그인 관리:
- 현재 버전 확인
- 업데이트 알림
- 보안 패치 안내

커스텀 코드 확인:
- 핵심 파일 변경 사항 탐지
- 무결성 검사
- 백업 권장 사항

#### 6.2 웹셸 방지
웹셸 스캐너:
- 의심스러운 파일 패턴 탐지
- 정기적인 파일 시스템 스캔
- 새로운 실행 파일 모니터링

파일 무결성 검사:
- 해시 기반 변경 탐지
- 중요 파일 모니터링
- 변경 알림 시스템

### 7. 사용자 관리 (User Management)

#### 7.1 세션 보안
세션 타임아웃 설정:
- 비활성 시간 기반 자동 로그아웃
- 역할별 타임아웃 설정
- 동시 로그인 제한

#### 7.2 회원가입 관리
승인제 시스템:
- 관리자 승인 후 활성화
- 승인 대기 회원 관리
- 자동 승인 조건 설정

이메일 검증:
- 회원가입 시 이메일 인증 필수화
- 이메일 유효성 검사
- 일회용 이메일 차단

#### 7.3 인증 강화
암호 정책 설정:
- 최소 길이/복잡도 요구사항
- 정기적인 암호 변경 알림
- 이전 암호 재사용 방지

2FA (Two-Factor Authentication):
- TOTP 기반 2단계 인증
- SMS 인증 옵션
- 백업 코드 생성

### 8. 콘텐츠 필터링 (Content Filtering)

#### 8.1 언어 제한
특정 언어만 댓글 허용:
- 언어 감지 시스템
- 허용 언어 설정
- 자동 차단/검토 기능

#### 8.2 정규식 필터
고급 패턴 매칭:
- 사용자 정의 정규식 규칙
- 실시간 콘텐츠 검사
- 규칙별 액션 설정

### 9. 지역 기반 제어 (Geographic Control)

#### 9.1 국가별 접근 제어
GeoIP 기반 차단:
- 국가별 접근 허용/차단
- VPN/프록시 탐지
- 지역별 통계

### 10. 모니터링 및 분석 (Monitoring & Analytics)

#### 10.1 스팸 통계
종합 통계 대시보드:
- 차단된 스팸 수
- 지역별/시간별 통계
- 트렌드 분석

#### 10.2 보안 로그
상세 로그 기록:
- 보안 이벤트 로그
- 접근 시도 기록
- 이상 행동 패턴 분석

### 11. 시스템 진단 (System Diagnostics)

#### 11.1 보안 파일 검사
위험 파일 탐지:
- 삭제되지 않은 install.php 확인
- .git 디렉토리 노출 검사
- 임시 파일/백업 파일 탐지

#### 11.2 링크 무결성
깨진 링크 검사:
- 내부 링크 유효성 검증
- 외부 링크 상태 확인
- 자동 수정 제안

#### 11.3 방화벽 관리
원클릭 방화벽:
- 기본 방화벽 규칙 적용
- 자동 IP 차단 규칙
- 실시간 위협 차단

## 기술적 고려사항

### 플러그인 아키텍처
- gnuboard5의 기존 플러그인 시스템 활용
- `extend/` 또는 `plugin/` 디렉토리 구조 준수
- 기존 코드 수정 없이 기능 확장

### 성능 최적화
- 데이터베이스 쿼리 최적화
- 캐싱 시스템 활용
- 비동기 처리 구현

### 호환성
- gnuboard5 다양한 버전 지원
- PHP 버전 호환성 확보
- 다른 플러그인과의 충돌 방지

## 현재 개발 현황

### 구현된 파일들
1. `adm/admin.menu950.php` - 보안설정 메뉴 정의
   - 메뉴 코드: 950000 (보안설정)
   - 하위 메뉴: HOME(950100), 접근제어(950200), 차단관리(950300), 권한관리(950400), 스팸관리(950500)
   - 각 메뉴별 권한 설정 포함

2. `adm/security_home.php` - 보안설정 대시보드 페이지
   - 보안 통계 현황판 (차단된 스팸, 공격시도, 블랙리스트 IP 등)
   - 시스템 상태 정보 (플러그인 버전, gnuboard5 버전)
   - 최근 보안 로그 테이블
   - 반응형 대시보드 UI 구현

3. `adm/css/admin.css` - 관리자 스타일시트 확장
   - 보안설정 메뉴 아이콘 스타일 추가
   - 기존 gnuboard5 관리자 UI와 일관된 디자인

4. `adm/img/menu_shield.png` - 보안설정 메뉴 아이콘
   - 방패 모양 아이콘으로 보안 기능을 시각적으로 표현

### 구현 상태

완료된 기능:
- 관리자 메뉴 구조 설계 및 구현
- 보안 대시보드 UI 구현
- 기존 gnuboard5와의 통합 인터페이스

진행 중인 기능:
- 실제 보안 로직 구현 대기
- 데이터베이스 테이블 설계 필요

대기 중인 기능:
- IP 차단 기능 확장
- 접근 제어 시스템
- 스팸 필터링
- 권한 관리 시스템

### 기술 구조 분석

파일 배치 전략:
- 관리자 파일: `/adm/` 디렉토리에 직접 배치 (메뉴, 페이지, CSS, 이미지)
- 확장 파일: `/extend/` 디렉토리 활용 (자동 로드되는 보안 로직)
- 플러그인 파일: `/plugin/security/` 디렉토리 활용 (독립적인 기능 모듈)

메뉴 시스템 통합:
- gnuboard5의 기존 메뉴 시스템(`$menu` 배열) 활용
- 메뉴 번호 950000번대로 보안 기능 그룹화
- 권한 체크 시스템 연동

## 개발 단계

1. Phase 1: 관리자 인터페이스 기본 구조 (완료)
2. Phase 2: 기본 접근제어 및 IP 차단 기능 확장 (진행중)
3. Phase 3: 스팸 방지 및 권한 관리
4. Phase 4: 시스템 보안 및 파일 검사
5. Phase 5: 고급 기능 및 모니터링
6. Phase 6: 테스트 및 최적화

## 테스트 계획

- 다양한 gnuboard5 환경에서의 테스트
- 보안 기능별 단위 테스트
- 통합 테스트 및 성능 테스트
- 관리자 인터페이스 사용성 테스트
